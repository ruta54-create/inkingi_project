{% extends 'base.html' %}

{% block title %}Cart Checkout - Inkingi Wood Ltd{% endblock %}

{% block content %}
<section class="cart-checkout-page py-5">
  <div class="container">
    <header class="mb-5 text-center">
      <h1 class="display-5 fw-bold mb-2">Order Checkout</h1>
      <p class="lead text-muted">Complete your purchase</p>
    </header>

    <div class="row">
      <!-- Order Summary -->
      <div class="col-lg-5 mb-4 mb-lg-0 order-lg-2">
        <div class="card shadow-sm border-0">
          <div class="card-header bg-light p-4 border-0">
            <h5 class="fw-bold mb-0">Order Summary</h5>
          </div>
          <div class="card-body p-4">
            <ul class="list-group list-group-flush">
              {% for product, quantity in items %}
                <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 py-3">
                  <div>
                    <strong>{{ product.name }}</strong>
                    <small class="d-block text-muted">Qty: {{ quantity }}</small>
                  </div>
                  <span class="fw-bold">{{ product.price|floatformat:2 }} RWF</span>
                </li>
              {% endfor %}
            </ul>

            <hr class="my-4">

            <div class="d-flex justify-content-between align-items-center mb-4">
              <span class="text-muted">Subtotal:</span>
              <span>{{ total|floatformat:2 }} RWF</span>
            </div>

            <div class="alert alert-info mb-0" role="alert">
              <p class="mb-0">
                <strong>Total Amount:</strong> <span class="h5 text-success fw-bold">{{ total|floatformat:2 }} RWF</span>
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Checkout Form -->
      <div class="col-lg-7 order-lg-1">
        <div class="card shadow-sm border-0">
          <div class="card-header bg-light p-4 border-0">
            <h5 class="fw-bold mb-0">Delivery Information</h5>
          </div>
          <div class="card-body p-5">
            <form method="post" novalidate>
              {% csrf_token %}

              <div class="mb-4">
                <label for="delivery_address" class="form-label fw-bold">Delivery Address</label>
                <textarea 
                  name="delivery_address" 
                  id="delivery_address"
                  class="form-control form-control-lg" 
                  rows="4"
                  placeholder="Enter your full delivery address"
                  required>{{ initial.delivery_address }}</textarea>
                <small class="form-text text-muted">Please provide your complete delivery address</small>
              </div>

              <div class="mb-4">
                <label for="phone" class="form-label fw-bold">Phone Number</label>
                <input 
                  type="tel"
                  name="phone" 
                  id="phone"
                  class="form-control form-control-lg" 
                  placeholder="Enter your contact number"
                  value="{{ initial.phone }}"
                  required>
                <small class="form-text text-muted">We'll use this to contact you about your order</small>
              </div>

              <div class="mb-4">
                <label class="form-label fw-bold">Payment Method</label>
                <div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="payment_method" id="pm_bank" value="bank" checked>
                    <label class="form-check-label" for="pm_bank">Bank Transfer</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="payment_method" id="pm_momo" value="momo">
                    <label class="form-check-label" for="pm_momo">Momo Pay</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="payment_method" id="pm_airtel" value="airtel">
                    <label class="form-check-label" for="pm_airtel">Airtel Money</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="payment_method" id="pm_other" value="other">
                    <label class="form-check-label" for="pm_other">Other</label>
                  </div>
                </div>
              </div>

              <div class="mb-4" id="mobileBoxCart" style="display:none;">
                <label for="mobile_number" class="form-label fw-bold">Mobile Number (for Momo/Airtel)</label>
                <input type="text" name="mobile_number" id="mobile_number" class="form-control" placeholder="e.g. 250788123456">
                <small class="form-text text-muted">Optional â€” used only for mock reference.</small>
              </div>

              <hr class="my-5">

              <div class="d-grid">
                <button type="submit" class="btn btn-view btn-lg fw-bold">
                  Place Order
                </button>
              </div>

              <p class="text-center text-muted small mt-4 mb-0">
                By placing this order, you agree to our terms and conditions
              </p>
            </form>
          </div>
        </div>

        <!-- Back to Cart Link -->
        <div class="text-center mt-4">
          <a href="{% url 'orders:cart' %}" class="btn btn-link">Back to Cart</a>
        </div>
      </div>
    </div>
  </div>
</section>
<script>
  (function(){
    const radios = document.querySelectorAll('input[name="payment_method"]');
    const mobileBox = document.getElementById('mobileBoxCart');
    function update(){
      const sel = document.querySelector('input[name="payment_method"]:checked');
      if(!sel) return;
      if(sel.value === 'momo' || sel.value === 'airtel') mobileBox.style.display = '';
      else mobileBox.style.display = 'none';
    }
    radios.forEach(r=>r.addEventListener('change', update));
    update();
  })();
</script>
{% endblock %}
