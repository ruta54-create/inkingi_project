{% extends 'base.html' %}

{% block title %}Payment Cancelled{% endblock %}

{% block content %}
<div class="container my-5">
  <div class="card p-4">
    <h2 class="mb-3">Payment Cancelled</h2>
    <p class="lead">Your payment for Order #{{ order.id }} was cancelled. You can retry or return to the product page.</p>
    <div class="d-flex align-items-center mb-3">
      <div id="cancel-spinner" class="me-3" style="display:none;">
        <div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>
      </div>
      <div>
        <a id="retry-btn" href="{% url 'orders:stripe_checkout' order.items.first.product.id %}" class="btn btn-primary">Retry Payment</a>
        <a href="{% url 'products:product_detail' order.items.first.product.id %}" class="btn btn-outline-secondary ms-2">Back to Product</a>
      </div>
    </div>
    <div id="cancel-toast-container" aria-live="polite" aria-atomic="true" style="position:fixed; top:1rem; right:1rem; z-index:1080"></div>
    <script>
      (function(){
        const retry = document.getElementById('retry-btn');
        const spinner = document.getElementById('cancel-spinner');
        const toastContainer = document.getElementById('cancel-toast-container');
        if(retry){
          retry.addEventListener('click', function(){
            spinner.style.display = 'inline-block';
            retry.classList.add('disabled');
            // small toast to notify user
            const t = document.createElement('div');
            t.className = 'toast align-items-center text-bg-info border-0 show';
            t.innerHTML = '<div class="d-flex"><div class="toast-body">Starting payment...</div></div>';
            toastContainer.appendChild(t);
            setTimeout(()=>{ try{ t.remove(); }catch(e){} }, 4000);
          });
        }
      })();
    </script>
  </div>
</div>
{% endblock %}