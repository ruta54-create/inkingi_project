{% extends 'base.html' %}

{% block title %}Edit Product{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <h2>Edit Product: {{ product.name }}</h2>
            <div class="card p-4">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ form.non_field_errors }}
                    <div class="mb-3">
                        <label class="form-label">Name</label>
                        {{ form.name }}
                        {% for e in form.name.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        {{ form.description }}
                        {% for e in form.description.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Price</label>
                            {{ form.price }}
                            {% for e in form.price.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Stock</label>
                            {{ form.stock }}
                            {% for e in form.stock.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">
                                Unit of Measurement <span class="text-muted">(Custom)</span>
                            </label>
                            {{ form.unit }}
                            
                            <!-- Datalist for autocomplete suggestions -->
                            <datalist id="unit-suggestions">
                                <option value="pcs">Pieces</option>
                                <option value="meter">Per Meter (m)</option>
                                <option value="sqm">Square Meter (m²)</option>
                                <option value="cbm">Cubic Meter (m³)</option>
                                <option value="kg">Kilogram</option>
                                <option value="bundle">Bundle</option>
                                <option value="set">Set</option>
                                <option value="pair">Pair</option>
                                <option value="dozen">Dozen</option>
                                <option value="ft">Feet</option>
                                <option value="inch">Inch</option>
                                <option value="cm">Centimeter</option>
                                <option value="liter">Liter</option>
                                <option value="board">Board</option>
                                <option value="plank">Plank</option>
                            </datalist>
                            
                            <div class="form-text">
                                <small class="text-muted">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Type your custom unit or select from suggestions. 
                                    <br>Examples: pcs, meter, sqm, kg, bundle, set, pair, etc.
                                </small>
                            </div>
                            
                            <!-- Quick suggestion buttons -->
                            <div class="mt-2">
                                <small class="text-muted d-block mb-1">Quick suggestions:</small>
                                <div class="btn-group-sm" role="group">
                                    <button type="button" class="btn btn-outline-secondary btn-sm unit-suggestion" data-unit="pcs">Pieces</button>
                                    <button type="button" class="btn btn-outline-secondary btn-sm unit-suggestion" data-unit="meter">Meter</button>
                                    <button type="button" class="btn btn-outline-secondary btn-sm unit-suggestion" data-unit="sqm">m²</button>
                                    <button type="button" class="btn btn-outline-secondary btn-sm unit-suggestion" data-unit="kg">Kg</button>
                                    <button type="button" class="btn btn-outline-secondary btn-sm unit-suggestion" data-unit="bundle">Bundle</button>
                                </div>
                            </div>
                            
                            {% for e in form.unit.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Category</label>
                            {{ form.category }}
                            {% for e in form.category.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Image</label>
                        {{ form.image }}
                        {% for e in form.image.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
                    </div>
                    <button class="btn btn-primary w-100" type="submit">Save changes</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function(){
    // Unit suggestion buttons functionality
    const unitInput = document.querySelector('input[name="unit"]');
    const unitSuggestionButtons = document.querySelectorAll('.unit-suggestion');
    
    if (unitInput && unitSuggestionButtons.length > 0) {
        unitSuggestionButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                const unit = this.getAttribute('data-unit');
                unitInput.value = unit;
                unitInput.focus();
                
                // Visual feedback
                unitSuggestionButtons.forEach(btn => btn.classList.remove('btn-primary'));
                unitSuggestionButtons.forEach(btn => btn.classList.add('btn-outline-secondary'));
                this.classList.remove('btn-outline-secondary');
                this.classList.add('btn-primary');
                
                // Reset button style after 2 seconds
                setTimeout(() => {
                    this.classList.remove('btn-primary');
                    this.classList.add('btn-outline-secondary');
                }, 2000);
            });
        });
        
        // Auto-suggest as user types
        unitInput.addEventListener('input', function() {
            const value = this.value.toLowerCase();
            
            // Highlight matching suggestion buttons
            unitSuggestionButtons.forEach(button => {
                const buttonUnit = button.getAttribute('data-unit').toLowerCase();
                if (buttonUnit.includes(value) && value.length > 0) {
                    button.classList.add('btn-outline-primary');
                    button.classList.remove('btn-outline-secondary');
                } else {
                    button.classList.add('btn-outline-secondary');
                    button.classList.remove('btn-outline-primary');
                }
            });
        });
    }
});
</script>
{% endblock %}
